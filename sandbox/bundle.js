var GM;
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	// The require scope
/******/ 	var __webpack_require__ = {};
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "GrowMap": () => (/* binding */ GrowMap)
/* harmony export */ });
var GrowMap = /** @class */ (function () {
    function GrowMap(container, things) {
        var _this = this;
        this.prepareThing = function (thing, i) {
            var preparedThing = {
                name: thing.name,
                position: {
                    x: 0,
                    y: 0,
                },
                size: {
                    width: null,
                    height: null,
                    fontSize: null,
                    padding: null,
                }
            };
            // Вычисляем ширину и высоту
            var thingSize = _this.getThingSize(thing);
            preparedThing.size = {
                width: thingSize.width,
                height: thingSize.height,
                fontSize: thingSize.fontSize,
                padding: thingSize.padding,
            };
            if (i === 0) {
                // preparedThing.position.x = things[0].position.x + things[0].size.width + this.params.globPadding;
            }
            // Нужно вычислить положение блока - но вычислить его можно токло после того как у предыдущего элемента есть ширина и высота
            // Что бы вычислить ширину и высоту нужно посчитать
            if (i !== 0) {
                preparedThing.position.x = 0;
                preparedThing.position.y = 0;
            }
            if (thing.children) {
                preparedThing.children = thing.children.map(function (thing, i) {
                    return _this.prepareThing(thing, i);
                });
            }
            return preparedThing;
        };
        this.prepareThings = function () {
            var things = _this.things;
            _this.preparedThings = things.map(_this.prepareThing);
            console.log('Things are prepared.');
        };
        this.init = function () {
            console.log('App initialization is started.');
            _this.canvas = document.createElement('canvas');
            _this.ctx = _this.canvas.getContext('2d');
            _this.prepareThings();
            var w = _this.container.clientWidth;
            var h = _this.container.clientHeight;
            _this.canvas.width = w;
            _this.canvas.height = h;
            _this.container.appendChild(_this.canvas);
            _this.ctx.translate(_this.canvas.width / 2, _this.canvas.height / 2);
            var observedContainerData = {
                previousWidth: null,
                previousHeight: null,
            };
            var containerResizeObserver = new ResizeObserver(function (entries) {
                if (!!(observedContainerData.previousWidth && observedContainerData.previousHeight) &&
                    ((entries[0].contentRect.width !== observedContainerData.previousWidth) ||
                        (entries[0].contentRect.height !== observedContainerData.previousHeight))) {
                    console.warn('Container size is changed - reload the app.');
                    containerResizeObserver.unobserve(_this.container);
                    _this.reload();
                }
                observedContainerData.previousWidth = entries[0].contentRect.width;
                observedContainerData.previousHeight = entries[0].contentRect.height;
            });
            containerResizeObserver.observe(_this.container);
            console.log('App is started.');
            window.requestAnimationFrame(function () {
                _this.drawBG();
                _this.drawRectangle(_this.preparedThings[0]);
            });
        };
        this.reload = function () {
            console.log('App reload is started.');
            _this.container.innerHTML = '';
            _this.init();
        };
        this.getThingSize = function (thing) {
            var fontSize = _this.params.fontSize;
            var textMetrics = _this.getTextSize(thing.name, fontSize);
            var p = fontSize / 4;
            var rectW = (p + textMetrics.width + p);
            var rectH = (p + _this.params.fontSize + p);
            return {
                fontSize: fontSize,
                width: rectW,
                height: rectH,
                padding: p,
            };
        };
        this.drawRectangle = function (thing) {
            _this.ctx.fillStyle = _this.params.rectColor;
            _this.ctx.fillRect(thing.position.x, thing.position.y, thing.size.width, thing.size.height);
            _this.drawText(thing.name, thing.position.x + thing.size.padding, thing.position.y + (thing.size.padding / 2) + thing.size.fontSize);
        };
        this.getTextSize = function (text, fontSize) {
            var previousFont = _this.ctx.font;
            _this.ctx.font = "".concat(fontSize, "px serif");
            var measuredText = _this.ctx.measureText(text);
            _this.ctx.font = previousFont;
            return measuredText;
        };
        this.drawText = function (text, x, y) {
            _this.ctx.font = "".concat(_this.params.fontSize, "px serif");
            _this.ctx.fillStyle = _this.params.fontColor;
            _this.ctx.fillText(text, x, y);
        };
        this.drawBG = function () {
            _this.ctx.fillStyle = _this.params.bgColor;
            _this.ctx.fillRect(-(_this.canvas.width / 2), -(_this.canvas.height / 2), _this.canvas.width, _this.canvas.height);
        };
        this.container = container;
        this.ctx = null;
        this.params = {
            bgColor: 'skyblue',
            fontSize: 160,
            fontColor: 'red',
            rectColor: 'white',
            globPadding: 20,
        };
        this.things = things;
        this.preparedThings = null;
    }
    return GrowMap;
}());


GM = __webpack_exports__;
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwibWFwcGluZ3MiOiI7OztVQUFBO1VBQ0E7Ozs7O1dDREE7V0FDQTtXQUNBO1dBQ0E7V0FDQSx5Q0FBeUMsd0NBQXdDO1dBQ2pGO1dBQ0E7V0FDQTs7Ozs7V0NQQTs7Ozs7V0NBQTtXQUNBO1dBQ0E7V0FDQSx1REFBdUQsaUJBQWlCO1dBQ3hFO1dBQ0EsZ0RBQWdELGFBQWE7V0FDN0Q7Ozs7Ozs7Ozs7OztBQzJDQTtJQWNJLGlCQUFZLFNBQWtCLEVBQUUsTUFBYztRQUE5QyxpQkFZQztRQUVPLGlCQUFZLEdBQUcsVUFBQyxLQUFZLEVBQUUsQ0FBUztZQUMzQyxJQUFNLGFBQWEsR0FBa0I7Z0JBQ2pDLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSTtnQkFDaEIsUUFBUSxFQUFFO29CQUNOLENBQUMsRUFBRSxDQUFDO29CQUNKLENBQUMsRUFBRSxDQUFDO2lCQUNQO2dCQUNELElBQUksRUFBRTtvQkFDRixLQUFLLEVBQUUsSUFBSTtvQkFDWCxNQUFNLEVBQUUsSUFBSTtvQkFDWixRQUFRLEVBQUUsSUFBSTtvQkFDZCxPQUFPLEVBQUUsSUFBSTtpQkFDaEI7YUFDSjtZQUVELDRCQUE0QjtZQUM1QixJQUFNLFNBQVMsR0FBRyxLQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRTNDLGFBQWEsQ0FBQyxJQUFJLEdBQUc7Z0JBQ2pCLEtBQUssRUFBRSxTQUFTLENBQUMsS0FBSztnQkFDdEIsTUFBTSxFQUFFLFNBQVMsQ0FBQyxNQUFNO2dCQUN4QixRQUFRLEVBQUUsU0FBUyxDQUFDLFFBQVE7Z0JBQzVCLE9BQU8sRUFBRSxTQUFTLENBQUMsT0FBTzthQUM3QjtZQUVELElBQUksQ0FBRyxLQUFLLENBQUMsRUFBRTtnQkFDWCxvR0FBb0c7YUFDdkc7WUFFRCw0SEFBNEg7WUFDNUgsbURBQW1EO1lBQ25ELElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDVCxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzdCLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUNoQztZQUVELElBQUksS0FBSyxDQUFDLFFBQVEsRUFBRTtnQkFDaEIsYUFBYSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFDLEtBQUssRUFBRSxDQUFDO29CQUNqRCxPQUFPLEtBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztnQkFDdEMsQ0FBQyxDQUFDLENBQUM7YUFDTjtZQUVELE9BQU8sYUFBYSxDQUFDO1FBQ3pCLENBQUM7UUFFTyxrQkFBYSxHQUFHO1lBQ1osVUFBTSxHQUFLLEtBQUksT0FBVCxDQUFVO1lBRXhCLEtBQUksQ0FBQyxjQUFjLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFcEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQ3hDLENBQUM7UUFFRCxTQUFJLEdBQUc7WUFDSCxPQUFPLENBQUMsR0FBRyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7WUFFOUMsS0FBSSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQy9DLEtBQUksQ0FBQyxHQUFHLEdBQUcsS0FBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFeEMsS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBRXJCLElBQU0sQ0FBQyxHQUFHLEtBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDO1lBQ3JDLElBQU0sQ0FBQyxHQUFHLEtBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDO1lBRXRDLEtBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztZQUN0QixLQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDdkIsS0FBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRXhDLEtBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztZQUVsRSxJQUFNLHFCQUFxQixHQUFRO2dCQUMvQixhQUFhLEVBQUUsSUFBSTtnQkFDbkIsY0FBYyxFQUFFLElBQUk7YUFDdkI7WUFFRCxJQUFNLHVCQUF1QixHQUFHLElBQUksY0FBYyxDQUFDLFVBQUMsT0FBTztnQkFDdkQsSUFDSSxDQUFDLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLElBQUkscUJBQXFCLENBQUMsY0FBYyxDQUFDO29CQUMvRSxDQUNJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEtBQUsscUJBQXFCLENBQUMsYUFBYSxDQUFDO3dCQUN0RSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxLQUFLLHFCQUFxQixDQUFDLGNBQWMsQ0FBQyxDQUMzRSxFQUNIO29CQUNFLE9BQU8sQ0FBQyxJQUFJLENBQUMsNkNBQTZDLENBQUMsQ0FBQztvQkFDNUQsdUJBQXVCLENBQUMsU0FBUyxDQUFDLEtBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztvQkFDbEQsS0FBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO2lCQUNqQjtnQkFFRCxxQkFBcUIsQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUM7Z0JBQ25FLHFCQUFxQixDQUFDLGNBQWMsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQztZQUN6RSxDQUFDLENBQUMsQ0FBQztZQUNILHVCQUF1QixDQUFDLE9BQU8sQ0FBQyxLQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFaEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBRS9CLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQztnQkFDekIsS0FBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNkLEtBQUksQ0FBQyxhQUFhLENBQUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9DLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQztRQUVPLFdBQU0sR0FBRztZQUNiLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztZQUN0QyxLQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7WUFDOUIsS0FBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2hCLENBQUM7UUFFTyxpQkFBWSxHQUFHLFVBQUMsS0FBWTtZQUNoQyxJQUFNLFFBQVEsR0FBRyxLQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztZQUN0QyxJQUFNLFdBQVcsR0FBRyxLQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFM0QsSUFBTSxDQUFDLEdBQUcsUUFBUSxHQUFHLENBQUMsQ0FBQztZQUV2QixJQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzFDLElBQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBRTdDLE9BQU87Z0JBQ0gsUUFBUSxFQUFFLFFBQVE7Z0JBQ2xCLEtBQUssRUFBRSxLQUFLO2dCQUNaLE1BQU0sRUFBRSxLQUFLO2dCQUNiLE9BQU8sRUFBRSxDQUFDO2FBQ2I7UUFDTCxDQUFDO1FBRU8sa0JBQWEsR0FBRyxVQUFDLEtBQW9CO1lBQ3pDLEtBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHLEtBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDO1lBQzNDLEtBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDM0YsS0FBSSxDQUFDLFFBQVEsQ0FDVCxLQUFLLENBQUMsSUFBSSxFQUNWLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUNyQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUNwRSxDQUFDO1FBQ04sQ0FBQztRQUVPLGdCQUFXLEdBQUcsVUFBQyxJQUFZLEVBQUUsUUFBZ0I7WUFDakQsSUFBTSxZQUFZLEdBQUcsS0FBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDbkMsS0FBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsVUFBRyxRQUFRLGFBQVUsQ0FBQztZQUN0QyxJQUFNLFlBQVksR0FBRyxLQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNoRCxLQUFJLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxZQUFZLENBQUM7WUFDN0IsT0FBTyxZQUFZLENBQUM7UUFDeEIsQ0FBQztRQUVPLGFBQVEsR0FBRyxVQUFDLElBQVksRUFBRSxDQUFTLEVBQUUsQ0FBUztZQUNsRCxLQUFJLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxVQUFHLEtBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxhQUFVLENBQUM7WUFDbEQsS0FBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsS0FBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7WUFDM0MsS0FBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNsQyxDQUFDO1FBRU8sV0FBTSxHQUFHO1lBQ2IsS0FBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsS0FBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUM7WUFDekMsS0FBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xILENBQUM7UUFwS0csSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDM0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7UUFDaEIsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNWLE9BQU8sRUFBRSxTQUFTO1lBQ2xCLFFBQVEsRUFBRSxHQUFHO1lBQ2IsU0FBUyxFQUFFLEtBQUs7WUFDaEIsU0FBUyxFQUFFLE9BQU87WUFDbEIsV0FBVyxFQUFFLEVBQUU7U0FDbEI7UUFDRCxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztJQUMvQixDQUFDO0lBMEpMLGNBQUM7QUFBRCxDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vR00vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vR00vd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL0dNL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vR00vd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9HTS8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIi8qKlxuICog0JrQsNGA0YLQsCDRgNC+0YHRgtCwXG4gKiBcbiAqINCi0YDQtdCx0L7QstCw0L3QuNGPOlxuICogKyAxKSDQn9GA0Lgg0YHQvtC30LTQsNC90LjQuCDQutCw0YDRgtGLINC90YPQttC90L4g0YPQutCw0LfQsNGC0Ywg0LrQvtC90YLQtdC50L3QtdGAXG4gKiArIDIpINCf0YDQuCDQuNC90LjRhtC40LDQu9C40LfQsNGG0LjQuCDQutCw0YDRgtGLINCyINC60L7QvdGC0LXQudC90LXRgCDQtNC+0LHQsNCy0LvRj9C10YLRgdGPINC60LDQvdCy0LDRgVxuICogKyAzKSDQmtCw0L3QstCw0YEg0LTQvtC70LbQtdC9INGA0LDRgdGC0Y/QvdGD0YLRjNGB0Y8g0L/QviDRgNCw0LfQvNC10YDRgyDQutC+0L3RgtC10LnQvdC10YDQsFxuICogKyA0KSDQmtCw0L3QstCw0YEg0LTQvtC70LbQtdC9INGB0LvQtdC00LjRgtGMINC30LAg0YDQsNC30LzQtdGA0L7QvCDQutC+0L3RgtC10LnQvdC10YDQsCDQuCDQtdGB0LvQuCDQvtC9INC80LXQvdGP0LXRgtGB0Y8gLSDQv9C10YDQtdC30LDQs9GA0YPQttCw0YLRjCDQv9GA0LjQu9C+0LbQtdC90LjQtVxuICogNSkg0JrQsNC90LLQsNGBINC00L7Qu9C20LXQvSDQv9GA0LjQvdC40LzQsNGC0Ywg0L3QsCDQstGF0L7QtCDQvtCx0YrQtdC60YIg0LjQu9C4INC80LDRgdGB0LjQsiDQvtCx0YXQtdC60YLQvtCyINC4INGA0LjRgdC+0LLQsNGC0Ywg0LPRgNCw0YTQuNC60YNcbiAqIDYpINCa0LDQvNC10YDQsCDQtNC+0LvQttC90LAg0YbQtdC90YLRgNC+0LLQsNGC0YzRgdGPINC/0L4g0LPQu9Cw0LLQvdC+0LzRgyDQvtCx0YzQtdC60YLRgyDQuNC70Lgg0L3QsNCx0L7RgNGDINCz0LvQsNCy0L3Ri9GFINC+0LHRitC10LrRgtC+0LJcbiAqIDcpINCSINC/0YDQvtCz0YDQsNC80LzQtSDQtNC+0LvQttC10L0g0LHRi9GC0Ywg0YDQtdCw0LvQuNC30L7QstCw0L0g0LfRg9C8XG4gKiA4KSDQn9GA0L7Qs9GA0LDQvNC80LAg0LzQvtC20LXRgiDQsdGL0YLRjCDQt9Cw0L/Rg9GJ0LXQvdCwINC30LDQt9Cw0YPQvNC70LXQvdC+0Lkg0Log0L7RgdC90L7QstC90YvQvCDQvtCx0LXQutGC0LDQvCDQuNC70Lgg0L7RhdCy0LDRgtGL0LLQsNGPINC+0LHRidC40Lkg0YDQsNC30LzQtdGAXG4gKiA5KSDQvNC40L3QuNC80LDQu9GM0L3Ri9C5INC30YPQvCDQvtC/0YDQtdC00LXQu9GP0LXRgtGB0Y8g0YDQsNC30LzQtdGA0L7QvCDQvtGB0L3QvtCy0L3QvtCz0L4g0LHQu9C+0LrQsCAtINC80LDQutGB0LjQvNCw0LvRjNC90YvQuSDQt9GD0Lwg0L7RhdCy0LDRgtC+0Lwg0LLRgdC10YUg0LHQu9C+0LrQvtCyINC/0LvRjtGBINC+0YLRgdGC0YPQv9GLXG4gKiAxMCkg0KDQsNC30LvQuNGH0L3Ri9C1INC90LDRgdGC0YDQvtC50LrQuCDQvNC+0LbQvdC+INCy0YvQstC+0LTQuNGC0Ywg0L3QsCDRjdC60YDQsNC9INGH0YLQvtCx0Ysg0L3QsNGB0YLRgNCw0LjQstCw0YLRjCDQuNGFINC/0L7Qu9C30YPQvdC60LDQvNC4XG4gKiAxMSkg0JrQsNC20LTRi9C5INGA0L7QtNC40YLQtdC70YzRgdC60LjQuSDQvtCx0YrQtdC60YIg0LzQvtC20LXRgiDQuNC80LXRgtGMINC00L7Rh9C10YDQvdC40LlcbiAqIDEyKSDQldGB0LvQuCDQsiDQtNC+0YfQtdGA0L3QtdC8INC90LUg0YPQutCw0LfQsNC90L4g0LIg0LrQsNC60YPRjiDRgdGC0L7RgNC+0L3RgyDQvtC9INGB0LzQtdGJ0LDQtdGC0YHRjyAtINGC0L4g0L7QvSDRgdC80LXRidCw0LXRgtGB0Y8g0LIg0YHQu9GD0YfQsNC50L3Rg9GOINGB0YLQvtGA0L7QvdGDXG4gKiAxMykg0JTQvtGH0LXRgNC90LjQtSDRjdC70LXQvNC10L3RgtGLINC40LzQtdGO0YIg0L7RgtGB0YLRg9C/INC+0YIg0YDQvtC00LjRgtC10LvRjNGB0LrQvtC60L4g0Lgg0YLQsNC6INC20LUg0LjQvNC10LXRgiDQvtGC0YHRgtGD0L8g0L7RgiDRgdCy0L7QuNGFINC60YPQt9C10L3QvtCyXG4gKiAxNCkg0JXRgdGC0Ywg0LLQvtC30LzQvtC20L3QvtGB0YLRjCDQvNGL0YjQutC+0Lkg0LTQstC40LPQsNGC0Ywg0LrQsNC80LXRgNGDXG4gKiAxNSkg0KMg0L/RgNC40LvQvtC20LXQvdC40Y8g0LXRgdGC0Ywg0L3QtdC60L7RgtC+0YDQvtC1INGB0L7RgdGC0L7Rj9C90LjQtSAtINGB0L7RgdGC0L7Rj9C90LjQtSDRhdGA0LDQvdC40YIg0LjQvdC40YbQuNCw0LvQuNC30LjRgNC+0LLQsNC90L3Ri9C1INC+0LHQtdC60YLRiyDQuCDQuNGFINGB0L7RgdGC0L7Rj9C90LjQtSAo0YDQsNGB0L/QvtC70L7QttC10L3QuNC1INC4INGC0LDQuiDQtNCw0LvQtdC10LUpXG4gKiAxNikg0J/QviDRjdC70LXQvNC10L3RgtGDINC80L7QttC90L4g0LrQu9C40LrQvdGD0YLRjCDQuCDQv9C+0LvRg9GH0LjRgtGMINCw0LrRgtC40LLQsNC40YDQvtCy0LDQvdC90YvQuSDRjdC70LXQvNC10L3RgiAtINGN0LvQtdC80LXQvdGCINC80L7QttC10YIg0LHRi9GC0Ywg0L/QvtC00YHQstC10YfQtdC9XG4gKiAxNykg0JXRgdC70Lgg0L/RgNC+0LjRgdGF0L7QtNC40YIg0LrQu9C40Log0L/QviDQtNGA0YPQs9C+0LzRgyDRjdC70LXQvNC10L3RgtGDIC0g0L/RgNC10LTRi9C00YPRidC40Lkg0L/QtdGA0LXRgdGC0LDQtdGCINCx0YvRgtGMINCw0LrRgtC40LLQvdGL0LxcbiAqIDE4KSDQldGB0LvQuCDQutC70LjQuiDQvdC1INCx0YvQuyDQutC70LjQutC90YPRgiDQvdC1INC/0L4g0L7QtNC90L7QvNGDINGN0LvQtdC80LXQvdGC0YMg0YLQviDQvdC40LrQsNC60L7Qs9C+INCw0LrRgtC40LLQvdC+0LPQviDRjdC70LXQvNC10L3RgtCwINC90LXRglxuICogMTkpINCjINGN0LvQtdC80LXQvdGC0L7QsiDQtdGB0YLRjCB6LWluZGV4IC0geiBpbmRleCDQstC70LjRj9C10YIg0L3QsCDQvtGC0YDQuNGB0L7QstC60YMg0Y3Qu9C10LzQtdC90YLQvtCyXG4gKiAyMCkg0JLRgdC1INC60YPQt9C10L3RiyDQuNC80LXRjtGCINC+0LTQuNC9INC4INGC0L7RgiDQttC1INC40L3QtNC10LrRgSAtINCy0YHQtSDQtNC+0YfQtdGA0L3QuNC1INC90LAg0LXQtNC40L3QuNGG0YMg0LHQvtC70YzRiNC1INGC0L4g0LXRgdGC0Ywg0L3QuNC20LVcbiAqIDIxKSDQkiDQutCw0LbQtNC+0Lwg0Y3Qu9C10LzQtdC90YLQtS/QsdC70L7QutC1INC80L7QttC90L4g0L3QsNC/0LjRgdCw0YLRjCDRgtC10LrRgdGCIC0g0YLQtdC60YHRgiDQvNC10L3Rj9C10YIg0YDQsNC30LzQtdGAINCx0LvQvtC60LAg0Y3Qu9C10LzQtdC90YLQsCAtINCy0YHQtSDQvtGB0YLQsNC70YzQvdGL0LUg0Y3Qu9C10LzQtdC90YLRiyDQv9C+0LTRgdGC0YDQsNCy0LjQstCw0Y7RgtGB0Y8g0L/QvtC0INC90L7QstGL0Lkg0YDQsNC30LzQtdGAINCx0LvQvtC60LBcbiAqL1xudHlwZSBUaGluZyA9IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgY2hpbGRyZW4/OiBBcnJheTxUaGluZz5cbn1cblxudHlwZSBUaGluZ3MgPSBBcnJheTxUaGluZz47XG5cbnR5cGUgUHJlcGFyZWRUaGluZyA9IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgY2hpbGRyZW4/OiBBcnJheTxQcmVwYXJlZFRoaW5nPlxuICAgIHBhcmVudD86IFByZXBhcmVkVGhpbmc7XG4gICAgcG9zaXRpb246IHtcbiAgICAgICAgeDogbnVtYmVyLFxuICAgICAgICB5OiBudW1iZXIsXG4gICAgfSxcbiAgICBzaXplOiB7XG4gICAgICAgIHdpZHRoOiBudW1iZXI7XG4gICAgICAgIGhlaWdodDogbnVtYmVyO1xuICAgICAgICBmb250U2l6ZTogbnVtYmVyO1xuICAgICAgICBwYWRkaW5nOiBudW1iZXI7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgR3Jvd01hcCB7XG4gICAgY29udGFpbmVyOiBFbGVtZW50O1xuICAgIGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xuICAgIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQ7XG4gICAgcGFyYW1zOiB7XG4gICAgICAgIGJnQ29sb3I6IHN0cmluZztcbiAgICAgICAgZm9udFNpemU6IG51bWJlcjtcbiAgICAgICAgZm9udENvbG9yOiBzdHJpbmc7XG4gICAgICAgIHJlY3RDb2xvcjogc3RyaW5nO1xuICAgICAgICBnbG9iUGFkZGluZzogbnVtYmVyO1xuICAgIH07XG4gICAgdGhpbmdzOiBUaGluZ3M7XG4gICAgcHJlcGFyZWRUaGluZ3M6IEFycmF5PFByZXBhcmVkVGhpbmc+O1xuXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyOiBFbGVtZW50LCB0aGluZ3M6IFRoaW5ncykge1xuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICAgICAgdGhpcy5jdHggPSBudWxsO1xuICAgICAgICB0aGlzLnBhcmFtcyA9IHtcbiAgICAgICAgICAgIGJnQ29sb3I6ICdza3libHVlJyxcbiAgICAgICAgICAgIGZvbnRTaXplOiAxNjAsXG4gICAgICAgICAgICBmb250Q29sb3I6ICdyZWQnLFxuICAgICAgICAgICAgcmVjdENvbG9yOiAnd2hpdGUnLFxuICAgICAgICAgICAgZ2xvYlBhZGRpbmc6IDIwLFxuICAgICAgICB9XG4gICAgICAgIHRoaXMudGhpbmdzID0gdGhpbmdzO1xuICAgICAgICB0aGlzLnByZXBhcmVkVGhpbmdzID0gbnVsbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHByZXBhcmVUaGluZyA9ICh0aGluZzogVGhpbmcsIGk6IG51bWJlcikgPT4ge1xuICAgICAgICBjb25zdCBwcmVwYXJlZFRoaW5nOiBQcmVwYXJlZFRoaW5nID0ge1xuICAgICAgICAgICAgbmFtZTogdGhpbmcubmFtZSxcbiAgICAgICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNpemU6IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogbnVsbCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IG51bGwsXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IG51bGwsXG4gICAgICAgICAgICAgICAgcGFkZGluZzogbnVsbCxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vINCS0YvRh9C40YHQu9GP0LXQvCDRiNC40YDQuNC90YMg0Lgg0LLRi9GB0L7RgtGDXG4gICAgICAgIGNvbnN0IHRoaW5nU2l6ZSA9IHRoaXMuZ2V0VGhpbmdTaXplKHRoaW5nKTtcblxuICAgICAgICBwcmVwYXJlZFRoaW5nLnNpemUgPSB7XG4gICAgICAgICAgICB3aWR0aDogdGhpbmdTaXplLndpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiB0aGluZ1NpemUuaGVpZ2h0LFxuICAgICAgICAgICAgZm9udFNpemU6IHRoaW5nU2l6ZS5mb250U2l6ZSxcbiAgICAgICAgICAgIHBhZGRpbmc6IHRoaW5nU2l6ZS5wYWRkaW5nLFxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGkgISA9PT0gMCkge1xuICAgICAgICAgICAgLy8gcHJlcGFyZWRUaGluZy5wb3NpdGlvbi54ID0gdGhpbmdzWzBdLnBvc2l0aW9uLnggKyB0aGluZ3NbMF0uc2l6ZS53aWR0aCArIHRoaXMucGFyYW1zLmdsb2JQYWRkaW5nO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g0J3Rg9C20L3QviDQstGL0YfQuNGB0LvQuNGC0Ywg0L/QvtC70L7QttC10L3QuNC1INCx0LvQvtC60LAgLSDQvdC+INCy0YvRh9C40YHQu9C40YLRjCDQtdCz0L4g0LzQvtC20L3QviDRgtC+0LrQu9C+INC/0L7RgdC70LUg0YLQvtCz0L4g0LrQsNC6INGDINC/0YDQtdC00YvQtNGD0YnQtdCz0L4g0Y3Qu9C10LzQtdC90YLQsCDQtdGB0YLRjCDRiNC40YDQuNC90LAg0Lgg0LLRi9GB0L7RgtCwXG4gICAgICAgIC8vINCn0YLQviDQsdGLINCy0YvRh9C40YHQu9C40YLRjCDRiNC40YDQuNC90YMg0Lgg0LLRi9GB0L7RgtGDINC90YPQttC90L4g0L/QvtGB0YfQuNGC0LDRgtGMXG4gICAgICAgIGlmIChpICE9PSAwKSB7XG4gICAgICAgICAgICBwcmVwYXJlZFRoaW5nLnBvc2l0aW9uLnggPSAwO1xuICAgICAgICAgICAgcHJlcGFyZWRUaGluZy5wb3NpdGlvbi55ID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGluZy5jaGlsZHJlbikge1xuICAgICAgICAgICAgcHJlcGFyZWRUaGluZy5jaGlsZHJlbiA9IHRoaW5nLmNoaWxkcmVuLm1hcCgodGhpbmcsIGkpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wcmVwYXJlVGhpbmcodGhpbmcsIGkpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHByZXBhcmVkVGhpbmc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwcmVwYXJlVGhpbmdzID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IHRoaW5ncyB9ID0gdGhpcztcblxuICAgICAgICB0aGlzLnByZXBhcmVkVGhpbmdzID0gdGhpbmdzLm1hcCh0aGlzLnByZXBhcmVUaGluZyk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ1RoaW5ncyBhcmUgcHJlcGFyZWQuJyk7XG4gICAgfVxuXG4gICAgaW5pdCA9ICgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0FwcCBpbml0aWFsaXphdGlvbiBpcyBzdGFydGVkLicpO1xuXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICB0aGlzLnByZXBhcmVUaGluZ3MoKTtcblxuICAgICAgICBjb25zdCB3ID0gdGhpcy5jb250YWluZXIuY2xpZW50V2lkdGg7XG4gICAgICAgIGNvbnN0IGggPSB0aGlzLmNvbnRhaW5lci5jbGllbnRIZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB3O1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSBoO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmNhbnZhcyk7XG5cbiAgICAgICAgdGhpcy5jdHgudHJhbnNsYXRlKHRoaXMuY2FudmFzLndpZHRoIC8gMiwgdGhpcy5jYW52YXMuaGVpZ2h0IC8gMik7XG5cbiAgICAgICAgY29uc3Qgb2JzZXJ2ZWRDb250YWluZXJEYXRhOiBhbnkgPSB7XG4gICAgICAgICAgICBwcmV2aW91c1dpZHRoOiBudWxsLFxuICAgICAgICAgICAgcHJldmlvdXNIZWlnaHQ6IG51bGwsXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjb250YWluZXJSZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoZW50cmllcykgPT4ge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICEhKG9ic2VydmVkQ29udGFpbmVyRGF0YS5wcmV2aW91c1dpZHRoICYmIG9ic2VydmVkQ29udGFpbmVyRGF0YS5wcmV2aW91c0hlaWdodCkgJiZcbiAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgIChlbnRyaWVzWzBdLmNvbnRlbnRSZWN0LndpZHRoICE9PSBvYnNlcnZlZENvbnRhaW5lckRhdGEucHJldmlvdXNXaWR0aCkgfHxcbiAgICAgICAgICAgICAgICAgICAgKGVudHJpZXNbMF0uY29udGVudFJlY3QuaGVpZ2h0ICE9PSBvYnNlcnZlZENvbnRhaW5lckRhdGEucHJldmlvdXNIZWlnaHQpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb250YWluZXIgc2l6ZSBpcyBjaGFuZ2VkIC0gcmVsb2FkIHRoZSBhcHAuJyk7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyUmVzaXplT2JzZXJ2ZXIudW5vYnNlcnZlKHRoaXMuY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbG9hZCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBvYnNlcnZlZENvbnRhaW5lckRhdGEucHJldmlvdXNXaWR0aCA9IGVudHJpZXNbMF0uY29udGVudFJlY3Qud2lkdGg7XG4gICAgICAgICAgICBvYnNlcnZlZENvbnRhaW5lckRhdGEucHJldmlvdXNIZWlnaHQgPSBlbnRyaWVzWzBdLmNvbnRlbnRSZWN0LmhlaWdodDtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnRhaW5lclJlc2l6ZU9ic2VydmVyLm9ic2VydmUodGhpcy5jb250YWluZXIpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdBcHAgaXMgc3RhcnRlZC4nKTtcblxuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZHJhd0JHKCk7XG4gICAgICAgICAgICB0aGlzLmRyYXdSZWN0YW5nbGUodGhpcy5wcmVwYXJlZFRoaW5nc1swXSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVsb2FkID0gKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnQXBwIHJlbG9hZCBpcyBzdGFydGVkLicpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRUaGluZ1NpemUgPSAodGhpbmc6IFRoaW5nKSA9PiB7XG4gICAgICAgIGNvbnN0IGZvbnRTaXplID0gdGhpcy5wYXJhbXMuZm9udFNpemU7XG4gICAgICAgIGNvbnN0IHRleHRNZXRyaWNzID0gdGhpcy5nZXRUZXh0U2l6ZSh0aGluZy5uYW1lLCBmb250U2l6ZSk7XG5cbiAgICAgICAgY29uc3QgcCA9IGZvbnRTaXplIC8gNDtcblxuICAgICAgICBjb25zdCByZWN0VyA9IChwICsgdGV4dE1ldHJpY3Mud2lkdGggKyBwKTtcbiAgICAgICAgY29uc3QgcmVjdEggPSAocCArIHRoaXMucGFyYW1zLmZvbnRTaXplICsgcCk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZvbnRTaXplOiBmb250U2l6ZSxcbiAgICAgICAgICAgIHdpZHRoOiByZWN0VyxcbiAgICAgICAgICAgIGhlaWdodDogcmVjdEgsXG4gICAgICAgICAgICBwYWRkaW5nOiBwLFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkcmF3UmVjdGFuZ2xlID0gKHRoaW5nOiBQcmVwYXJlZFRoaW5nKSA9PiB7XG4gICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IHRoaXMucGFyYW1zLnJlY3RDb2xvcjtcbiAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QodGhpbmcucG9zaXRpb24ueCwgdGhpbmcucG9zaXRpb24ueSwgdGhpbmcuc2l6ZS53aWR0aCwgdGhpbmcuc2l6ZS5oZWlnaHQpO1xuICAgICAgICB0aGlzLmRyYXdUZXh0KFxuICAgICAgICAgICAgdGhpbmcubmFtZSxcbiAgICAgICAgICAgIHRoaW5nLnBvc2l0aW9uLnggKyB0aGluZy5zaXplLnBhZGRpbmcsXG4gICAgICAgICAgICB0aGluZy5wb3NpdGlvbi55ICsgKHRoaW5nLnNpemUucGFkZGluZyAvIDIpICsgdGhpbmcuc2l6ZS5mb250U2l6ZSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFRleHRTaXplID0gKHRleHQ6IHN0cmluZywgZm9udFNpemU6IG51bWJlcik6IFRleHRNZXRyaWNzID0+IHtcbiAgICAgICAgY29uc3QgcHJldmlvdXNGb250ID0gdGhpcy5jdHguZm9udDtcbiAgICAgICAgdGhpcy5jdHguZm9udCA9IGAke2ZvbnRTaXplfXB4IHNlcmlmYDtcbiAgICAgICAgY29uc3QgbWVhc3VyZWRUZXh0ID0gdGhpcy5jdHgubWVhc3VyZVRleHQodGV4dCk7XG4gICAgICAgIHRoaXMuY3R4LmZvbnQgPSBwcmV2aW91c0ZvbnQ7XG4gICAgICAgIHJldHVybiBtZWFzdXJlZFRleHQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkcmF3VGV4dCA9ICh0ZXh0OiBzdHJpbmcsIHg6IG51bWJlciwgeTogbnVtYmVyKSA9PiB7XG4gICAgICAgIHRoaXMuY3R4LmZvbnQgPSBgJHt0aGlzLnBhcmFtcy5mb250U2l6ZX1weCBzZXJpZmA7XG4gICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IHRoaXMucGFyYW1zLmZvbnRDb2xvcjtcbiAgICAgICAgdGhpcy5jdHguZmlsbFRleHQodGV4dCwgeCwgeSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkcmF3QkcgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IHRoaXMucGFyYW1zLmJnQ29sb3I7XG4gICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KC0odGhpcy5jYW52YXMud2lkdGggLyAyKSwgLSh0aGlzLmNhbnZhcy5oZWlnaHQgLyAyKSwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9